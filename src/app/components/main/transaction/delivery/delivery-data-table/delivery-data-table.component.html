<div class="scrolly">
  <ng-container *ngIf="advanceSearchRequest.length>0">
    <app-search-criteria [data]="advanceSearchRequest" (change)="onChangeCriteria()" (close)="onCloseCriteria()">
    </app-search-criteria>
  </ng-container>
  <!-- <button (click)="selectedS()">click</button> -->
  <div class="del-margin-bottom">
    <div class="table-responsive">
      <table class="table table-hover" mat-table [dataSource]="dataSource">
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef class="cdk-column-select">
            <button class="btn btn-sm filter-btn" *ngIf="!isDetailVisible" [matMenuTriggerFor]="menu">
              <i class="fa fa-table" aria-hidden="true"></i>
            </button>
            <mat-menu #menu="matMenu">
              <div class="card-body p-2" style="min-width: 200px;">
                <ul style="list-style: none; padding-left: 7px;">
                  <li *ngFor="let column of filterColumns">
                    <input type="checkbox" [(ngModel)]="column.show" class="m-2" (click)="$event.stopPropagation()" />
                    {{ column.title }}
                  </li>
                </ul>
                <div class="float-right mb-2">
                  <button class="btn btn-p bg-secondary">Cancel</button>
                </div>
              </div>
            </mat-menu>
            <mat-checkbox class="head-checkbox" (change)="$event ? toggleSelection() : null"
              (change)="getSelectedRows()" [checked]="selections.hasValue() && isAllSelected()"
              [indeterminate]="selections.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox class="row-checkbox" (click)="$event.stopPropagation()"
              (change)="$event  ? selections.toggle(row) : null" (change)="getSelectedRows()"
              [disabled]="!row.isCheckEnable" [checked]="selections.isSelected(row) && row.isCheckEnable"
              [aria-label]="checkboxLabel(row)">
            </mat-checkbox>
          </td>
        </ng-container>
        <ng-container matColumnDef="misc">
          <th mat-header-cell *matHeaderCellDef>Orders</th>
          <td mat-cell *matCellDef="let element" class="misc-cell">
            <span class="col-name">{{
              element.customer
              ? element.customer.customer_name
              : element.depot.depot_name
              }}</span>
            <span class="col-price">{{
              numberFormatWithSymbol(element.grand_total)
              }}</span>
            <span class="col-date">{{ element.order_date }}</span>
            <span class="col-code">{{ element.order_number }}</span>
          </td>
        </ng-container>
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Date" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="date" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('date')"
                placeholder="Enter Date" type="date">
            </app-column-filter>
          </th>
          <!-- <td mat-cell *matCellDef="let element">{{ element.order?.order_date }}</td> -->
          <td mat-cell *matCellDef="let element">
            {{ element.created_at | date: "d MMM y h:mm a" }}
          </td>
        </ng-container>
        <ng-container matColumnDef="code">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Delivery Number" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="code" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('code')"
                placeholder="Enter Delivery Number" type="text">
            </app-column-filter>
          </th>
          <td mat-cell *matCellDef="let element">{{ element.delivery_number }}</td>
        </ng-container>
        <ng-container matColumnDef="orderCode">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Order Number" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="order_code" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('order_code')"
                placeholder="Enter Order Number" type="text">
            </app-column-filter>
          </th>
          <td mat-cell *matCellDef="let element">{{ element?.order?.order_number }}</td>
        </ng-container>
        <ng-container matColumnDef="branch_plant_code">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Branch Plant" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="branch_plant_code" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('branch_plant_code')"
                placeholder="Enter Branchplant code" type="text">
            </app-column-filter>
          </th>
          <td mat-cell *matCellDef="let element">{{ element?.storageocation?.code }}</td>
        </ng-container>
        <ng-container matColumnDef="customer_code">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Customer Code" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="customer_code" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('customer_code')"
                placeholder="Enter Customer Code" type="text">
            </app-column-filter>
          </th>
          <td mat-cell *matCellDef="let element">{{ element?.customer?.customer_info?.customer_code }}</td>
        </ng-container>
        <!--  Customer LPO   -->
        <ng-container matColumnDef="customer_lpo">
          <th mat-header-cell *matHeaderCellDef>

            <app-column-filter title="Customer LPO" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="customer_lpo" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('customer_lpo')"
                placeholder="Enter Customer Code" type="text">
            </app-column-filter>

          </th>
          <td mat-cell *matCellDef="let element" (click)="openDetailView(element)">
            {{ element?.order?.customer_lop }}</td>
        </ng-container>
        <!--   Customer LPO End-->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Customer Name" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="customer_name" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('customer_name')"
                placeholder="Enter Customer Name" type="text">
            </app-column-filter>

          </th>
          <td mat-cell *matCellDef="let element">
            {{
            element.customer
            ? element?.customer?.firstname + " " + element?.customer?.lastname
            : element?.depot?.depot_name
            }}
          </td>
        </ng-container>

        <!-- <ng-container matColumnDef="channel_name">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Service Channel" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="channel_name" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('channel_name')"
                placeholder="Enter Channel Name" type="text">
            </app-column-filter>

          </th>
          <td mat-cell *matCellDef="let element" (click)="openDetailView(element)">
            <ng-container>
              {{
                element.customer_category?.customer_category_name
              }}
            </ng-container>
          </td>
        </ng-container> -->


        <ng-container matColumnDef="channel_name">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Service Channel" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="channel_name" (close)="onColumnFilter($event)">
              <mat-select multiple class="form-control form-control-sm" [formControl]="filterForm.get('channel_name')">
                <mat-option *ngFor="let item of channelList" [value]="item.id">
                  {{ item?.name }}
                </mat-option>
              </mat-select>
            </app-column-filter>
          </th>
          <td mat-cell *matCellDef="let element" (click)="openDetailView(element)">
            <ng-container>
              <span>
                {{ element.customer_category?.customer_category_name }} 
              </span>
            </ng-container>
        
          </td>
        </ng-container>



        <!--  Route Code-->
        <!-- <ng-container matColumnDef="route_code">
          <th mat-header-cell *matHeaderCellDef>

            <app-column-filter title="Route Code" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="route_code" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('route_code')"
                placeholder="Enter Route Code" type="text">
            </app-column-filter>

          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.route?.route_code }}</td>
        </ng-container> -->
        <!--  End Route code -->
        <!-- Route Name -->
        <!-- <ng-container matColumnDef="route_name">
          <th mat-header-cell *matHeaderCellDef>

            <app-column-filter title="Route Name" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="route_name" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('route_name')"
                placeholder="Enter Route Name" type="text">
            </app-column-filter>

          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.route?.route_name }}</td>
        </ng-container> -->
        <!-- End Route Name -->
        <!-- Salesman Code -->
        <ng-container matColumnDef="salesman_code">
          <th mat-header-cell *matHeaderCellDef>

            <app-column-filter title="Salesman Code" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="salesman_code" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('salesman_code')"
                placeholder="Enter Salesman Code" type="text">
            </app-column-filter>

          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.salesman?.salesman_info?.salesman_code }}</td>
        </ng-container>
        <!-- End Salesman Code   -->
        <!-- Salesman Name -->
        <ng-container matColumnDef="salesman_name">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Salesman Name" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="salesman_name" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('salesman_name')"
                placeholder="Enter Salesman Name" type="text">
            </app-column-filter>

          </th>
          <td mat-cell *matCellDef="let element">
            <ng-container>
              {{
              element?.salesman == null ? '' :
              element.salesman?.firstname + " " + element.salesman?.lastname
              }}
            </ng-container>
          </td>
        </ng-container>
        <!-- End Salesman Name -->
        <ng-container matColumnDef="due">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Delivery Date" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="delivery_date" (close)="onColumnFilter($event)">
              <input class="form-control form-control-sm" [formControl]="filterForm.get('delivery_date')"
                placeholder="Enter Delivery Date" type="date">
            </app-column-filter>

          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.delivery_date }}
          </td>
        </ng-container>
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>Amount</th>
          <td mat-cell *matCellDef="let element">
            {{numberFormatWithSymbol(element.grand_total) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="approval">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Approval" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="current_stage" (close)="onColumnFilter($event)">
              <mat-select class="form-control form-control-sm" [formControl]="filterForm.get('current_stage')">
                <mat-option *ngFor="let item of approvalStatusList" [value]="item.id">
                  {{ item.name }}
                </mat-option>
              </mat-select>
            </app-column-filter>
          </th>
          <td mat-cell *matCellDef="let element">
            <ng-container>
              <span [style.color]="orderStatusColor(element.current_stage)">
                {{ getOrderStatusValue(element.current_stage) }}
              </span>
            </ng-container>

          </td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>
            <app-column-filter title="Status" (changeSelected)="onColumnFilterOpen($event)"
              [selected]="selectedColumnFilter" controlName="approval_status" (close)="onColumnFilter($event)">
              <mat-select class="form-control form-control-sm" [formControl]="filterForm.get('approval_status')">
                <mat-option *ngFor="let item of orderStatusList" [value]="item.id">
                  {{ item.name }}
                </mat-option>
              </mat-select>
            </app-column-filter>
          </th>
          <td mat-cell *matCellDef="let element">
            <ng-container>
              <span>
                {{ element.approval_status }}<a *ngIf="element.approval_status ==='Cancel'" href="javascript:void(0)"
                  matTooltip="Cancel Reason: {{element.reason?.name}}"><i class="fa fa-info-circle"
                    aria-hidden="true"></i></a>
              </span>
            </ng-container>

          </td>
        </ng-container>
        <ng-container matColumnDef="expand">
          <th mat-header-cell *matHeaderCellDef style="display: none;">Detail</th>
          <td mat-cell *matCellDef="let element">
            <div style="display: flex; justify-content: space-between;">
              <strong>{{
                element.customer
                ? element?.customer?.firstname + " " + element?.customer?.lastname
                : element?.depot?.depot_name
                }}</strong>
              <span>
                {{ numberFormatWithSymbol(element.grand_total) }}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: #2485e8;">{{ element.delivery_number }}</span>
              <span style="color: #2485e8;">
                {{ element.delivery_due_date }}</span>
            </div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="getDisplayedColumns()"></tr>
        <tr mat-row *matRowDef="let row; columns: getDisplayedColumns()" [ngClass]="{ 'misc-row': isDetailVisible }"
          (click)="openDetailView(row)"></tr>
      </table>
    </div>
    <mat-paginator [hidden]="apiResponse.pagination?.total_records < 10" (page)="onPageFired($event)"
      [length]="apiResponse.pagination?.total_records" [pageSize]="pageSize" [pageSizeOptions]="[10, 25, 50]">
    </mat-paginator>
  </div>
  <div>
<div id="isShow" style="position:fixed; top:0;display:none; justify-content: center; align-items:center;width:100%;height:100%;left:0;background:#0005;">
  <div class="card" style="width:300px;height:300px;">
    <div class="card-header pt-4">
        <span class="h6 font-weight-bold">Delivery Trips Change </span>
        <div (click)="closeReason()" class="closeicon settingclose"><i class="os-icon os-icon-x"></i></div>
    </div>
    <div class="card-body">
        <form >
            <div>
                <div class="row">
                    <div class="col-12 d-flex align-items-center">
                        <label class="half-w  mb-0">Trip:</label>
                        <input type="number"  name="trip" class="form-control form-control-sm"
                            placeholder="Enter trips"  [(ngModel)]="tripAllChanges">
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="card-footer">
        <div class="d-inline float-right">
            <button class="btn btn-sm btn-p" type="button" (click)="changAllTrips()" >
                Submit
            </button>
            <button class="btn btn-sm btn-white mr-2" (click)="closeReason()">Cancel</button>
        </div>
    </div>
</div>
</div>
</div>
</div>

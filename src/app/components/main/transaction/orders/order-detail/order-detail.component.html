<section>
    <div class="heading-row clearfix">
        <h2 class="h4 font-weight-light d-md-inline">
            <i class="os-icon os-icon-shopping-cart mr-2"></i>Order
            <span class="order-number">#{{ orderData?.order_number }}</span>
        </h2>
        <div class="d-md-inline float-md-right">
            <div class="btn-group btnrow mr-2">
                <button class="btn" type="button" [autoClose]="'outside'" triggers="manual" #email="ngbPopover" placement="bottom" (click)="email.open();" [ngbPopover]="emailPopContent" [popoverTitle]="emailPopTitle">
          <i class="os-icon os-icon-mail"></i>
        </button>
                <button (click)="onToggleHistory()" class="btn" type="button">
          <mat-icon [inline]="true">textsms</mat-icon>
        </button>
                <button [disabled]="checkUserCanEdit(orderData?.approval_status)" class="btn" type="button" [routerLink]="['/transaction/order/edit', orderData?.uuid]">
          <i class="os-icon os-icon-edit-32"></i>
        </button>
                <button class="btn" type="button" (click)="getDocument('pdf')">
          <mat-icon [inline]="true">picture_as_pdf</mat-icon>
        </button>
                <button class="btn" type="button" (click)="getDocumentForPDF(orderData)" *ngIf="orderData?.order_generate_picking==1">
          <i class="os-icon os-icon-printer"></i>
        </button>
                <!-- <button class="btn" type="button" (click)="checkDownloadOrPrint()">
          <i class="os-icon os-icon-printer"></i>
        </button> -->
                <!-- <span *ngIf="orderData?.order_generate_picking==1">
          <button mat-button class="btn btn-sm btn-white dropdown-toggle" [matMenuTriggerFor]="menu2">
            <i class="os-icon os-icon-printer"></i>
          </button>
          <mat-menu #menu2="matMenu" xPosition="before">
            <button mat-menu-item class="btn btn-sm" (click)="print();" *ngIf="orderData?.picking_status==1">
              Print Pickslip
            </button>
            <button mat-menu-item class="btn btn-sm" (click)="getDocument('pdf')">
              Print Order
            </button>
          </mat-menu>
        </span> -->
            </div>
            <!-- <span>
        <button mat-button class="btn btn-sm btn-white dropdown-toggle" [matMenuTriggerFor]="menu3"
          *ngIf="(orderData?.approval_status =='Created'|| orderData?.approval_status =='Updated') && currentRole==='Warehouse'">
          More
        </button>
        <mat-menu #menu3="matMenu" xPosition="before">
          <button mat-menu-item class="btn btn-sm" (click)="startDelivery()">
            Generate PickSlip
          </button>
        </mat-menu>
      </span> -->
            <span *ngIf="currentRole=='Storekeeper'|| currentRole==='org-admin' || currentRole==='super-admin' || currentRole=='Warehouse'">
        <button mat-button class="btn btn-sm btn-white dropdown-toggle" [matMenuTriggerFor]="menu2">
          More
        </button>
        <mat-menu #menu2="matMenu" xPosition="before">
          <button
            *ngIf="orderData?.current_stage !='Approved' && (currentRole==='org-admin' || currentRole==='super-admin')"
            mat-menu-item class="btn btn-sm" (click)="openDeleteBox(false)">
            Delete
          </button>
          <button mat-menu-item class="btn btn-sm" *ngIf="currentRole=='Storekeeper' && (orderData?.approval_status=='Created' || orderData?.approval_status=='Updated')" (click)="openDeleteBox(true)">
            Cancel
          </button>
          <button mat-menu-item class="btn btn-sm" *ngIf="checkWarehosePersmission(orderData?.approval_status,currentRole)" (click)="openDeleteBox(true)">
            Cancel
          </button>
          <button mat-menu-item class="btn btn-sm" (click)="startDelivery()"
            *ngIf="currentRole=='Warehouse' && orderData?.current_stage =='Approved' && (orderData?.approval_status=='Created' || orderData?.approval_status=='Updated')">
            Generate PickSlip
          </button>
        </mat-menu>
      </span>
            <button class="btn" (click)="closeDetailView()">
        <i class="os-icon os-icon-close"></i>
      </button>
            <!-- <button mat-button class="btn btn-sm back-btn btn-secondary ml-2" (click)="goToOrders()"><i class="os-icon os-icon-arrow-left2"></i><span class=""> Back</span></button> -->
        </div>
    </div>
    <div class="separator"></div>

    <div class="approval-holder" *ngIf="hasApprovalPending">
        <div class="approval-box">
            <div class="approve-icon">
                <i class="fa fa-check-square-o"></i>
            </div>
            <div class="approve-content">
                <h2>Approve this order</h2>
                <p>
                    This order has been submitted for approval. Verify and approve the order.
                </p>
            </div>
            <div class="approve-actions">
                <button mat-button class="approve" (click)="approve()">Approve</button>
                <button mat-button class="reject" (click)="reject()">Reject</button>
            </div>
        </div>
    </div>

    <form class="order-form custom-mat square customertab">
        <div class="card-header active-form overview" [hidden]="ordertypehidden">
            <div class="row justify-content-between">
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Order Type</label>
                        <input type="text" class="form-control form-control-sm non-editable" [value]="orderTypeTitle" disabled />
                    </div>
                </div>
            </div>
        </div>

        <div class="card-body overview">
            <div class="row justify-content-between">
                <div class="col-md-4">
                    <div class="form-group" *ngIf="!isDepotOrder">
                        <label>Customer</label>
                        <input type="text" class="form-control form-control-sm non-editable" [value]="
                orderData?.customer?.firstname +
                ' ' +
                orderData?.customer?.lastname
              " disabled />
                    </div>
                    <div class="form-group" *ngIf="!isDepotOrder">
                        <label>Customer Code</label>
                        <input type="text" class="form-control form-control-sm non-editable" [value]="
                orderData?.customer?.customer_info?.customer_code" disabled />
                    </div>
                    <div class="form-group" *ngIf="!isDepotOrder">
                        <label for="">Customer Lob</label>
                        <input type="text" class="form-control form-control-sm non-editable" [value]="
            orderData?.lob?.name || ''" disabled />
                    </div>

                    <div class="form-group" *ngIf="orderData?.storageocation?.code">
                        <label for="">Warehouse</label>
                        <input type="text" class="form-control form-control-sm non-editable" [value]="
            orderData?.storageocation?.code +'-'+ orderData?.storageocation?.name || ''" disabled />
                    </div>
                    <div class="form-group" *ngIf="isDepotOrder">
                        <label>Depot</label>
                        <input type="text" class="form-control form-control-sm non-editable" [value]="orderData?.depot?.depot_name" disabled />
                    </div>
                    <!-- <div class="form-group" *ngIf="!isDepotOrder && orderData?.salesman">
            <label>{{domain == 'nfpc' || domain == 'merchandising' ? 'Merchandiser' : 'Salesman'}}</label>
            <input type="text" class="form-control form-control-sm non-editable" [value]="
                orderData?.salesman ? orderData?.salesman?.firstname + orderData?.salesman?.lastname : ''
              " disabled />
          </div> -->
                    <div class="form-group" *ngIf="orderData?.customer_lop">
                        <label>Customer LPO</label>
                        <input type="text" class="form-control form-control-sm non-editable" [value]="orderData?.customer_lop" disabled />
                    </div>
                </div>
                <div class="col-md-4">
                    <!-- <div class="form-group">
            <label>Order Number</label>
            <input type="text" class="form-control form-control-sm non-editable" [value]="orderData?.order_number"
              disabled />
          </div> -->

                    <div class="form-group">
                        <label>Delivery Date</label>
                        <input type="date" class="form-control form-control-sm non-editable" [value]="orderData?.delivery_date" disabled />
                    </div>

                    <div class="form-group">
                        <label>Order Number</label>
                        <input type="text" class="form-control form-control-sm non-editable" [value]="orderData?.order_number" disabled />
                    </div>
                    <!-- <div>
                        <button class="btn btn-sm btn-white dropdown-toggle" mat-button [matMenuTriggerFor]="menu2">
                          {{ orderData?.orderTypes ? orderData.orderTypes : 'Select' }}
                        </button>
                      
                        <mat-menu #menu2="matMenu">
                          <button mat-menu-item (click)="setOrderType('Horeca')">Horeca</button>
                          <button mat-menu-item (click)="setOrderType('Modern Trade')">Modern Trade</button>
                        </mat-menu>
                      </div> -->
                      
                      
                      
                      
                      
                   







                      
                    <!-- <div class="form-group">
            <label>Payment Terms</label>
            <input type="text" class="form-control form-control-sm non-editable" [value]="orderData?.payment_term?.name"
              disabled />
          </div>
          <div class="form-group">
            <label>Due Date</label>
            <input type="date" class="form-control form-control-sm non-editable" [value]="orderData?.due_date"
              disabled />
          </div> -->
                    <div class="form-group" *ngIf="orderData?.reason">
                        <label>Cancel Reason</label>
                        <input type="string" class="form-control form-control-sm non-editable" [value]="orderData?.reason.name" disabled />
                    </div>
                </div>
            </div>
        </div>
        <div>
            <div class="item-container custom-mat custom-mat-no-border">
                <div class="table-responsive">
                    <table class="cardtable item-table">
                        <thead>
                            <tr>
                                <ng-container *ngFor="let head of itemTableHeaders">
                                    <th class="head" *ngIf="head.show">
                                        {{ head.label }}
                                    </th>
                                </ng-container>
                            </tr>
                        </thead>
                        <tbody class="form-body">
                            <tr class="item-row" [ngClass]="item.is_deleted == 1 ? 'disabled' : ''" *ngFor="let item of orderData?.order_details; let i = index">
                                <td data-th="#">{{ i + 1 }}</td>
                                <td data-th="Item Code" class="item-name" style="width: 150px;">
                                    <!-- <input type="text" class="form-control form-control-sm non-editable" [value]="item.item.item_name"
                    disabled /> -->
                                    <span style="word-break: break-word; font-size: 11px;">{{item?.item?.item_code}}</span>
                                </td>
                                <td data-th="Customer Item Code" class="item-name" style="width: 150px;" *ngIf="orderData?.source==5">
                                    <!-- <input type="text" class="form-control form-control-sm non-editable" [value]="item.item.item_name"
                    disabled /> -->
                                    <span style="word-break: break-word; font-size: 11px;">{{item?.item_vendor_code?item?.item_vendor_code:''}}</span>
                                </td>
                                <td data-th="Item Name" class="item-name" style="width: 150px;">
                                    <!-- <input type="text" class="form-control form-control-sm non-editable" [value]="item.item.item_name"
                    disabled /> -->
                                    <span style="word-break: break-word; font-size: 11px;">{{item?.item?.item_name}}</span>
                                </td>
                                <td data-th="UOM" class="uom-td">
                                    <input type="text" class="form-control form-control-sm non-editable" [value]="item?.item_uom?.name" disabled />
                                </td>
                                <td data-th="Quantity">
                                    <input type="number" min="0" class="form-control non-editable" [value]="item.item_qty" disabled />
                                </td>

                                <td data-th="Item Name" class="item-name" style="width: 150px;">

                                    <span style="word-break: break-word; font-size: 11px;">{{item?.reason?.code}} -
                    {{item?.reason?.name}}</span>
                                </td>
                                <td data-th="Price">
                                    <input type="text" class="form-control non-editable" [value]="numberFormat(item?.item_price)" disabled />
                                </td>
                                <td data-th="Excise">
                                    <input type="text" class="form-control non-editable" [value]="numberFormat(item?.item_excise)" disabled />
                                </td>
                                <td data-th="Discount">
                                    <input type="text" class="form-control non-editable" [value]="numberFormat(item?.item_discount_amount)" disabled />
                                </td>
                                <td data-th="Net">
                                    <input type="text" class="form-control non-editable" [value]="numberFormat(item?.item_net)" disabled />
                                </td>
                                <td data-th="Vat">
                                    <input type="text" class="form-control non-editable" [value]="numberFormat(item?.item_vat)" disabled />
                                </td>


                                <td data-th="Total" style="width:10px;">
                                    <input type="text" class="form-control non-editable" [value]="numberFormat(item?.item_grand_total)" disabled />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="footer-overview-container">
                <div class="row justify-content-between">
                    <div class="form-group col-sm-5">
                        <label for="note">Customer Note</label>
                        <textarea class="form-control form-control-sm" id="note" [value]="orderData?.any_comment ? orderData.any_comment : ''" disabled></textarea>
                    </div>
                    <div class="col-sm-4">
                        <div class="overall-stats-table">
                            <div *ngFor="let stat of orderStats.slice(0, orderStats.length - 1)">
                                <span class="stat-label">{{ stat.label }}</span>
                                <span class="stat-value">{{
                  orderData && numberFormatWithSymbol(orderData[stat.key])
                  }}</span>
                                <!-- <span class="stat-value">{{
                  orderData && orderData[stat.key]
                    
                }}</span> -->
                            </div>
                            <div>
                                <span class="stat-label final-total">Total</span>
                                <span class="stat-value final-total">{{
                  numberFormatWithSymbol(orderData?.grand_total)
                  }}</span>
                                <!-- <span class="stat-value final-total">{{
                  orderData?.grand_total 
                }}</span> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <!-- <div class="footer-block"></div> -->
</section>
<ng-container *ngIf="showSpinner">
    <mat-progress-spinner class="example-margin" [color]="color" [mode]="mode" strokeWidth="3">
    </mat-progress-spinner>
</ng-container>
<ng-template #emailPopTitle>
    <span>Send Order {{orderData.order_number}}</span>
</ng-template>
<ng-template #emailPopContent>
    <app-send-email [data]="emailData" (close)="email.close()"></app-send-email>
</ng-template>


<div class="container" hidden id="print-section">

    <div class="row">
        <div class="col-xs-6">
            <div>
                <div class="question-arrow">Sold To: </div>
                <p class="indent-text" style="font-size: 10px;">
                    <span>{{orderData?.customer?.customer_info?.customer_code}}</span><br>
                    <span style="line-height: 30px;">
            {{orderData?.customer?.firstname}}  {{orderData?.customer?.lastname}}<br>
          </span>

                    <span style="line-height: 30px;">
            {{orderData?.customer?.customer_info?.customer_address_1}}<br>
            {{orderData?.customer?.customer_info?.customer_address_2}}<br>
            {{orderData?.customer?.customer_info?.customer_address_3?orderData?.customer?.customer_info?.customer_address_3:'-'}}<br>      
              </span>
                    <span style="line-height: 30px;">
            {{orderData?.storageocation?.name}}<br>
            {{orderData?.picking_slip_generator?.user?.firstname}}
            {{orderData?.picking_slip_generator?.user?.lastname}}<br>
          </span>
                </p>
            </div>
            <div>
                <div class="question-arrow">Customer PO: </div>
                <p class="indent-text" style="font-size: 10px;">{{orderData?.customer_lop}}</p>
            </div>
        </div>
        <div class="col-xs-3">
            <div>
                <strong style="letter-spacing: 4px;font-family: Times New Roman, Times, serif;font-size: 16px;">PICK
          SLIP</strong><br><br><br><br>
                <div>
                    <p class="dateTime">Date: {{orderData?.picking_slip_generator?.date}}</p>
                </div>
                <div>
                    <p class="dateTime">Time: {{orderData?.updated_at| date:'hh:mm:ss'}}</p>
                </div>
                <div>
                    <p class="dateTime">Page: 1</p>
                </div>
            </div>
        </div>
        <div class="col-xs-3">
            <div>
                <div class="question-arrow">Route Code: </div>
                <p class="indent-text" style="font-size: 10px;text-align: right;">
                    {{orderData?.route?.code?orderData?.route?.code:'0000'}}</p>
            </div>
            <br>
            <div>
                <div class="question-arrow">Order Number: </div>
                <p class="indent-text" style="font-size: 10px;text-align: right;">{{orderData?.order_number}}</p>
            </div>
            <br>
            <div>
                <div class="question-arrow">Brn/Plt: </div>
                <p class="indent-text" style="font-size: 10px;text-align: right;">{{ orderData?.storageocation?.code}}</p>
            </div>
            <br>
            <div>
                <div class="question-arrow">Pick Slip #: </div>
                <p class="indent-text" style="font-size: 10px;text-align: right;font-weight: bold;">
                    {{orderData?.picking_slip_generator?.id}}</p>
            </div>
            <br>
            <div>
                <div class="question-arrow">Order Date: </div>
                <p class="indent-text" style="font-size: 10px;text-align: right;">{{orderData?.delivery_date}}</p>
            </div>
        </div>

    </div>


    <div class="row">
        <div class="col-md-12">
            <div>

                <div>
                    <div>
                        <table class="table">
                            <thead>
                                <tr style="font-size:10px;font-family: Times New Roman, Times, serif;">
                                    <td>Description</td>
                                    <td class="text-center">Item Number</td>
                                    <td class="text-center">UOM</td>
                                    <td class="text-right">Shipped</td>
                                    <td class="text-right">Truck</td>
                                    <td class="text-right">Location</td>
                                    <td class="text-right">Expiration Date</td>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- foreach ($order->lineItems as $line) or some such thing here -->
                                <tr *ngFor="let item of orderData?.order_details" style="font-size:10px;font-family: Times New Roman, Times, serif;">
                                    <td>{{item?.item?.item_name}}</td>
                                    <td class="text-center">{{item?.item?.item_code}}</td>
                                    <td class="text-center">{{item?.item_uom?.name}}</td>
                                    <td class="text-right">{{item?.item_qty}}</td>
                                    <td class="text-right">NFPC</td>
                                    <td class="text-right">-</td>
                                    <td class="text-right">-</td>

                                </tr>

                            </tbody>
                        </table>
                    </div>
                    <div style="font-size: 10px;">
                        <div class="col-xs-4">
                            Driver Signature
                        </div>
                        <div class="col-xs-4">
                            Customer Signature
                        </div>
                        <div class="col-xs-4">
                            **Final**
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>